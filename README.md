# 医療紹介状→初診カルテ変換アプリ（改善版）

## 改善のポイント

実際の医療現場で使用されている初診カルテの形式に準拠した、より正確な情報抽出システムです。

### 主な改善点

#### 1. **SOAP形式への完全準拠**
添付ファイルの初診カルテで使用されているSOAP形式（Subjective, Objective, Assessment, Plan）に完全対応しました。

- **S (Subjective)**: 患者・家族の訴え、主訴
- **O (Objective)**: 
  - 意識レベル（意識清明など）
  - 全身状態
  - 身体所見（心音、呼吸音、腹部所見など）
  - 検査結果（心電図、画像所見、血液検査など）
- **A (Assessment)**: 診断名、病状評価
- **P (Plan)**: 治療計画、紹介先

#### 2. **病名の正確な記載**
実際の医療現場と同じく、病名には必ず「#」を付けて記載します。

```
例：
#アルツハイマー型認知症
#高血圧症
#虚血性心疾患
```

#### 3. **認知症評価の詳細化**
MMSEスコアを含む、認知症の包括的な評価項目を追加：

- 認知症の有無と種類
- 重症度（軽度/中等症/重度、またはⅠ〜Ⅳ、M）
- **MMSE得点**（例: "16/30" または "16点（30点）"）
- 周辺症状（BPSD）の内容

#### 4. **ADL評価の詳細化**
実際の訪問診療で必要とされる詳細なADL評価：

- 歩行：独歩/杖歩行/歩行器/車椅子/寝たきり
- 食事：自立/一部介助/全介助
- 排泄：自立/一部介助/全介助/おむつ/カテーテル
- 入浴：自立/一部介助/全介助
- 着衣：自立/一部介助/全介助
- 日常動作：自立度の記載
- IADL：手段的日常生活動作

#### 5. **ACP（アドバンス・ケア・プランニング）の充実**
添付ファイルに記載されている詳細な意思決定項目を網羅：

- 急変時対応（DNRなど）
- 延命治療の意向
- 経管栄養・胃瘻の希望
- 治療可能な急性疾患への対応
- 入院の希望
- 臓器提供・ブレインバンク登録

#### 6. **服薬情報の分類**
定期内服薬と頓服薬（屯用薬）を明確に分類：

- **定期内服薬**: 毎日服用する薬
- **頓服・屯用薬**: 症状時や必要時に使用する薬（使用条件も含む）

#### 7. **経過概略の構造化**
時系列での病歴を構造化：

- 発症と経過：いつから、どのように進行したか
- 紹介理由：今回の紹介に至った経緯
- 最近の変化：直近で起きた変化

#### 8. **介護情報の充実**
在宅医療に不可欠な社会的背景情報：

- 要介護度（要支援1〜2、要介護1〜5）
- 障害者手帳の等級
- 家族構成
- キーパーソン（氏名・続柄・連絡先）
- 利用中の介護サービス
- 本人が過ごしたい場所

#### 9. **バイタルサインの明示**
初診時のバイタル情報を個別に記録：

- 身長、体重
- 血圧、脈拍
- 体温、SpO2

#### 10. **アレルギー・副作用歴の詳細化**
医療安全に重要な情報を明確に分類：

- 薬剤アレルギー
- 食物アレルギー
- 喘息の有無
- 副作用歴（薬剤と症状）

## 実際の初診カルテとの対応

### 添付ファイル「初診カルテ.pdf」の記載項目との対応表

| カルテ記載項目 | システムでの対応 | 抽出項目 |
|---------------|-----------------|---------|
| 名前・生年月日 | ✅ 完全対応 | patient_info |
| バイタル（身長・体重） | ✅ 完全対応 | vitals |
| SOAP形式 | ✅ 完全対応 | soap (S/O/A/P) |
| MMSE得点 | ✅ 完全対応 | cognitive_status.mmse_score |
| 病名（#付き） | ✅ 完全対応 | diagnosis |
| 紹介先 | ✅ 対応 | soap.plan |
| 経過概略 | ✅ 完全対応 | clinical_course |
| 既往歴 | ✅ 完全対応 | past_medical_history |
| アレルギー・副作用歴 | ✅ 完全対応 | allergies, adverse_drug_reactions |
| 生活歴（喫煙・飲酒・職業） | ✅ 完全対応 | lifestyle |
| ADL・IADL | ✅ 完全対応 | adl |
| 認知症の有無と重症度 | ✅ 完全対応 | cognitive_status |
| 介護度 | ✅ 完全対応 | care_info.care_level |
| 家族構成・キーパーソン | ✅ 完全対応 | care_info |
| 過ごしたい場所 | ✅ 完全対応 | care_info.preferred_location |
| 急変時対応・ACP | ✅ 完全対応 | advance_care_planning |
| 治療計画 | ✅ 完全対応 | treatment_plan |
| 経過（定期診察記録） | ✅ 対応 | clinical_course |
| 服薬情報 | ✅ 完全対応 | current_medications, prn_medications |

### 添付ファイル「紹介状例.pdf」からの抽出項目

実際の紹介状に記載されている全ての項目を正確に抽出できます：

- 患者基本情報（氏名、住所、電話番号、生年月日）
- 病名（複数の病名を # 付きで抽出）
- 紹介目的
- 既往歴・家族歴
- 生活歴（喫煙・飲酒歴）
- アレルギー・副作用
- 介護度、自立度
- ADL詳細（歩行、食事、入浴、排泄など）
- 認知症評価（種類、重症度、MMSE）
- 難病申請・障害認定
- 家族構成・キーパーソン
- ACP（急変時対応、延命治療、経口摂取困難時の対応など）
- 症状経過・検査結果
- 現在の処方（定期薬・頓服薬）

## 使い方

### セットアップ

```bash
# 依存パッケージのインストール
pip install -r requirements.txt

# Google Gemini APIキーの設定
# .streamlit/secrets.toml に以下を記載
# GOOGLE_API_KEY = "your-api-key-here"

# アプリの起動
streamlit run app_improved.py
```

### 画像から抽出

1. 「📷 画像アップロード」タブを選択
2. 紹介状の写真またはPDFをアップロード
3. 「🔍 情報を抽出して初診カルテを作成」ボタンをクリック
4. 実際の初診カルテ形式で結果が表示されます

### テキストから抽出

1. 「📝 テキスト入力」タブを選択
2. 紹介状のテキストを貼り付け
3. 「🔍 情報を抽出して初診カルテを作成」ボタンをクリック
4. 実際の初診カルテ形式で結果が表示されます

## 表示形式

抽出された情報は、実際の初診カルテと同じ構造で表示されます：

1. **患者基本情報**: 氏名、生年月日、年齢、性別
2. **バイタルサイン**: 身長、体重、血圧、脈拍、体温、SpO2
3. **SOAP**: S/O/A/P の4項目で構造化
4. **病名**: # 付きで列挙
5. **経過概略**: 発症・経過、紹介理由、最近の変化
6. **既往歴・アレルギー・生活歴**: 詳細な医療歴
7. **ADL・IADL**: 日常生活動作の詳細評価
8. **認知症評価**: MMSE含む包括的評価
9. **介護情報**: 要介護度、家族構成、キーパーソン
10. **ACP**: 詳細な意思決定内容
11. **服薬情報**: 定期薬と頓服薬を分類
12. **治療計画**: 今後の方針

## 技術スタック

- **Frontend**: Streamlit
- **AI Model**: Google Gemini 2.0 Flash (最新モデル)
- **Image Processing**: Pillow (PIL)
- **Data Display**: Pandas

## 医療現場での活用

このシステムは以下のような場面で活用できます：

1. **訪問診療開始時**: 紹介状から初診カルテを自動作成
2. **診療所間の連携**: 他院からの紹介状を効率的に取り込み
3. **入院・転院時**: 患者情報の迅速な把握と記録
4. **カンファレンス準備**: 患者情報の構造化と共有

## 注意事項

- このアプリはデモ・研究用です
- 実際の医療現場での使用には、医療機器としての承認や個人情報保護対策が必要です
- 抽出結果は必ず医療従事者が確認・修正してください
- APIキーは厳重に管理し、外部に公開しないでください

## 今後の拡張可能性

- [ ] 検査データの自動グラフ化
- [ ] 過去カルテとの差分表示
- [ ] 服薬情報の相互作用チェック
- [ ] 電子カルテシステムへの直接入力
- [ ] 音声入力対応
- [ ] 多言語対応

## ライセンス

医療ハッカソン デモアプリケーション
